<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <title>GShare Manager - 설정</title>
</head>
<body class="bg-gray-100">
    <div class="min-h-screen p-4">
        <div class="max-w-7xl mx-auto">
            <div class="flex items-center justify-between mb-4">
                <h1 class="text-xl font-bold text-gray-800">GShare Manager - 설정</h1>
                <a href="/" 
                    class="bg-gray-50 hover:bg-blue-100 text-gray-700 hover:text-blue-800 rounded-lg p-2 border border-gray-200 hover:border-blue-200 transition-colors duration-200">
                    <div class="flex items-center justify-center gap-1">
                        <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9 15L3 9m0 0l6-6M3 9h12a6 6 0 010 12h-3" />
                        </svg>
                        <span class="text-sm font-medium">돌아가기</span>
                    </div>
                </a>
            </div>

            <div class="bg-white shadow rounded-lg p-6">
                <h2 class="text-lg font-semibold text-gray-900 mb-6">시스템 설정</h2>
                
                <form id="settingsForm" class="space-y-8">
                    <!-- Proxmox 설정 -->
                    <div>
                        <h3 class="text-sm font-medium text-gray-900 mb-4">Proxmox 설정</h3>
                        <div class="grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-2">
                            <div>
                                <label for="PROXMOX_HOST" class="block text-sm font-medium text-gray-700">Proxmox 호스트</label>
                                <input type="text" name="PROXMOX_HOST" id="PROXMOX_HOST" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                            </div>
                            <div>
                                <label for="NODE_NAME" class="block text-sm font-medium text-gray-700">노드 이름</label>
                                <input type="text" name="NODE_NAME" id="NODE_NAME" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                            </div>
                            <div>
                                <label for="VM_ID" class="block text-sm font-medium text-gray-700">VM ID</label>
                                <input type="text" name="VM_ID" id="VM_ID" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                            </div>
                            <div>
                                <label for="TOKEN_ID" class="block text-sm font-medium text-gray-700">API 토큰 ID</label>
                                <input type="text" name="TOKEN_ID" id="TOKEN_ID" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                            </div>
                            <div>
                                <label for="SECRET" class="block text-sm font-medium text-gray-700">API 시크릿</label>
                                <input type="password" name="SECRET" id="SECRET" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                            </div>
                        </div>
                    </div>

                    <!-- CPU 모니터링 설정 -->
                    <div>
                        <h3 class="text-sm font-medium text-gray-900 mb-4">CPU 모니터링 설정</h3>
                        <div class="grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-3">
                            <div>
                                <label for="CPU_THRESHOLD" class="block text-sm font-medium text-gray-700">CPU 임계값 (%)</label>
                                <input type="number" name="CPU_THRESHOLD" id="CPU_THRESHOLD" step="0.1" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                            </div>
                            <div>
                                <label for="CHECK_INTERVAL" class="block text-sm font-medium text-gray-700">체크 간격 (초)</label>
                                <input type="number" name="CHECK_INTERVAL" id="CHECK_INTERVAL" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                            </div>
                            <div>
                                <label for="THRESHOLD_COUNT" class="block text-sm font-medium text-gray-700">임계값 체크 횟수</label>
                                <input type="number" name="THRESHOLD_COUNT" id="THRESHOLD_COUNT" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                            </div>
                        </div>
                    </div>

                    <!-- 마운트 설정 -->
                    <div>
                        <h3 class="text-sm font-medium text-gray-900 mb-4">마운트 설정</h3>
                        <div class="grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-2">
                            <div>
                                <label for="MOUNT_PATH" class="block text-sm font-medium text-gray-700">마운트 경로</label>
                                <input type="text" name="MOUNT_PATH" id="MOUNT_PATH" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                            </div>
                            <div>
                                <label for="GET_FOLDER_SIZE_TIMEOUT" class="block text-sm font-medium text-gray-700">폴더 크기 체크 타임아웃 (초)</label>
                                <input type="number" name="GET_FOLDER_SIZE_TIMEOUT" id="GET_FOLDER_SIZE_TIMEOUT" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                            </div>
                        </div>
                    </div>

                    <!-- SMB 설정 -->
                    <div>
                        <h3 class="text-sm font-medium text-gray-900 mb-4">SMB 설정</h3>
                        <div class="grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-2">
                            <div>
                                <label for="SMB_SHARE_NAME" class="block text-sm font-medium text-gray-700">SMB 공유 이름</label>
                                <input type="text" name="SMB_SHARE_NAME" id="SMB_SHARE_NAME" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                            </div>
                            <div>
                                <label for="SMB_USERNAME" class="block text-sm font-medium text-gray-700">SMB 사용자 이름</label>
                                <input type="text" name="SMB_USERNAME" id="SMB_USERNAME" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                            </div>
                            <div>
                                <label for="SMB_PASSWORD" class="block text-sm font-medium text-gray-700">SMB 비밀번호</label>
                                <input type="password" name="SMB_PASSWORD" id="SMB_PASSWORD" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                            </div>
                            <div>
                                <label for="SMB_COMMENT" class="block text-sm font-medium text-gray-700">SMB 설명</label>
                                <input type="text" name="SMB_COMMENT" id="SMB_COMMENT" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                            </div>
                            <div class="flex items-center">
                                <input type="checkbox" name="SMB_GUEST_OK" id="SMB_GUEST_OK" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                                <label for="SMB_GUEST_OK" class="ml-2 block text-sm text-gray-900">게스트 접근 허용</label>
                            </div>
                            <div class="flex items-center">
                                <input type="checkbox" name="SMB_READ_ONLY" id="SMB_READ_ONLY" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                                <label for="SMB_READ_ONLY" class="ml-2 block text-sm text-gray-900">읽기 전용</label>
                            </div>
                        </div>
                    </div>

                    <!-- 기타 설정 -->
                    <div>
                        <h3 class="text-sm font-medium text-gray-900 mb-4">기타 설정</h3>
                        <div class="grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-2">
                            <div>
                                <label for="SHUTDOWN_WEBHOOK_URL" class="block text-sm font-medium text-gray-700">종료 웹훅 URL</label>
                                <input type="text" name="SHUTDOWN_WEBHOOK_URL" id="SHUTDOWN_WEBHOOK_URL" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                            </div>
                            <div>
                                <label for="TIMEZONE" class="block text-sm font-medium text-gray-700">시간대</label>
                                <input type="text" name="TIMEZONE" id="TIMEZONE" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                            </div>
                        </div>
                    </div>

                    <div class="flex justify-end space-x-3">
                        <button type="button" onclick="loadSettings()" class="bg-gray-200 py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500">
                            새로고침
                        </button>
                        <button type="submit" class="bg-indigo-600 py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                            저장
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // 설정 로드
        async function loadSettings() {
            try {
                const response = await fetch('/get_config');
                const data = await response.json();
                
                if (data.status === 'success') {
                    const config = data.config;
                    console.log(config);
                    Object.keys(config).forEach(key => {
                        const element = document.getElementById(key);
                        if (element) {
                            if (element.type === 'checkbox') {
                                element.checked = config[key];
                            } else {
                                element.value = config[key];
                            }
                        }
                    });
                }
            } catch (error) {
                console.error('설정 로드 실패:', error);
                alert('설정을 로드하는데 실패했습니다.');
            }
        }

        // 설정 저장
        document.getElementById('settingsForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const data = {};
            
            formData.forEach((value, key) => {
                if (key === 'SMB_GUEST_OK' || key === 'SMB_READ_ONLY') {
                    data[key] = document.getElementById(key).checked;
                } else {
                    data[key] = value;
                }
            });

            try {
                const response = await fetch('/update_config', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data),
                });

                const result = await response.json();
                
                if (result.status === 'success') {
                    alert('설정이 저장되었습니다. 변경사항을 적용하려면 서비스를 재시작하세요.');
                } else {
                    alert('설정 저장 실패: ' + result.message);
                }
            } catch (error) {
                console.error('설정 저장 실패:', error);
                alert('설정을 저장하는데 실패했습니다.');
            }
        });

        // 페이지 로드 시 설정 로드
        document.addEventListener('DOMContentLoaded', loadSettings);
    </script>
</body>
</html> 